
name: Teste Automatizado - Smoke Test
on: [ push ]

# on:
#   push:
#     branches: [ master ]

jobs:

    test:
        runs-on: ubuntu-latest
        name: Teste automatizados
        steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-python@v4
          with:
            python-version: '3.9'
            cache: 'pip' # caching pip dependencies
        - run: pip install robotframework
        - run: pip install -r requirements.txt
        - run: robot -d reports -v SALCELABS:False ./test/*.robot

        - name: Upload test results
          uses: actions/upload-artifact@v1
          if: always()
          with:
            name: reports
            path: reports
    
        - name: Gerando Reports
          uses: actions/download-artifact@v1
          with:
            name: reports
            
        - name: Send Slack notification
          uses: craftech-io/slack-action@v1
          with:
            slack_webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
            slack_channel: nossa
            slack_username: Robozao
            status: success
            if: success()
       
        - name: Enviar arquivo para o Slack
          env:
             SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
             SLACK_CHANNEL: nossa
          run: |
            curl -F file=@reports/logs.html -F "initial_comment=Novo arquivo gerado!" -F channels=$SLACK_CHANNEL $SLACK_WEBHOOK_URL

       

